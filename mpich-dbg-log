#!/bin/zsh

unset MPICH_DBG_LEVEL
unset MPICH_DBG_FILENAME
unset MPICH_DBG_CLASS
export MPICH_DBG_LEVEL=VERBOSE
export MPICH_DBG_FILENAME="dbg-%w-%d.log"
#export MPICH_DBG_FILENAME="dbg-%w-%d-%p.log"
export MPICH_DBG_CLASS=SHM_IPC,SHM_IPC_XPMEM
export MPICH_DBG_CLASS=CH4,CH4_DBG,CH4_MAP,CH4_COMM,$MPICH_DBG_CLASS
# export MPICH_DBG_CLASS=HCOLL,$MPICH_DBG_CLASS
export MPICH_DBG_CLASS=INIT,PT2PT,THREAD,DATATYPE,HANDLE,COMM,BSEND,ERRHAND,OTHER,REQUEST,COLL,ASSERT,STRING,$MPICH_DBG_CLASS
export MPICH_DBG_CLASS=ALL,ROUTINE,ROUTINE_ENTER,ROUTINE_EXIT,$MPICH_DBG_CLASS
# export FI_LOG_LEVEL=Warn
# export FI_LOG_SUBSYS=core,fabric,ep_ctrl,ep_data,av
# export FI_LOG_PROV=sockets

if [[ $PMI_RANK = 0 ]]; then
    env | grep -E "MPICH_DBG_"
fi

$@
